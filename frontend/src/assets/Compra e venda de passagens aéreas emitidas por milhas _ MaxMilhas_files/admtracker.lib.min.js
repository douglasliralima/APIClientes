!function(r){var e,t,n,a,u=r.adm,o=r.location.pathname,s=Date.now?parseInt(Date.now()):(new Date).getTime(),i={morethan:function(e,t){return e<t},lessthan:function(e,t){return t<e},equalto:function(e,t){return e===t},contains:function(e,t){return-1!==t.toUpperCase().indexOf(e.toUpperCase())}},c=["url_contains","url_match","url_does_not_contain","url_does_not_match","frequency","anniversary","custom_data","time_spent"];if(!u)return console.error("ADM Pixel Error: Pixel code is not installed correctly on this page.");Array.indexOf||(Array.prototype.indexOf=function(e){for(var t=0;t<this.length;t++)if(this[t]==e)return t;return-1}),r.localStorage&&(e=r.localStorage),r.sessionStorage&&(t=r.sessionStorage);var l=e.getItem("adm.usrmeta");l?n=JSON.parse(l):(n=[{p:"ALL",d:{fq:0,lv:[s]}}],e.setItem("adm.usrmeta",JSON.stringify(n)));var f=x("ALL",n).d,p=x(o,n);if(u.customData=r.admCustomData,p)p=p.d;else{var m={p:o,d:{fq:0,lv:[s]}};n.push(m),e.setItem("adm.usrmeta",JSON.stringify(n)),p=m.d}var d=t.getItem("adm.sesh");p.fq=p.fq+1,d||(t.setItem("adm.sesh",s),f.fq=f.fq+1);var h=parseInt(p.fq),g=parseInt(f.fq);function v(){var e=r.XDomainRequest?new XDomainRequest:new XMLHttpRequest,t=u.json;e.overrideMimeType&&e.overrideMimeType("application/json"),e.open("GET",t,!0),r.XDomainRequest?(e.onload=function(){y((a=JSON.parse(e.responseText)).pixels)},e.onerror=function(){console.log("ADM Pixel Error: Cannot get JSON")}):e.onreadystatechange=function(){4==e.readyState&&"200"==e.status&&y((a=JSON.parse(e.responseText)).pixels)},setTimeout(function(){e.send(null)},0)}function y(e){for(var t=[u.pixid],r=e.length-1;0<=r;r--)if(u.processRules(e[r]))if(e[r].custom_data&&e[r].custom_data.length&&u.customData&&u.customData.length){var n=D(e[r],u.customData[0]);_([e[r].id],n)}else t.push(e[r].id);return _(t)}function _(e,t){var r=u.pixurl+"/pixel?",n="id="+e.toString(),a=document.getElementsByTagName("head")[0],o=document.createElement("script");if(t&&1===e.length&&(n+="&"+t),n+="&t=js",o.type="text/javascript",o.src=r+n,o.async=!0,!function(e){for(var t=document.getElementsByTagName("script"),r=t.length;r--;)if(t[r].src==e)return!0;return!1}(o.src))return a.appendChild(o),o;console.log("Pixel already fired")}function D(e,t){var r=[];for(var n in t)if(t.hasOwnProperty(n)&&-1<e.custom_data.indexOf(n))if("[object Array]"===Object.prototype.toString.call(t[n])){var a;if(a=t[n].join("+"),e.rules)for(var o=0;o<e.rules.length;o++){var s=e.rules[o];-1<t[n].indexOf(s.values.value)&&(a=s.values.value)}r.push(n+"="+encodeURIComponent(a))}else r.push(n+"="+encodeURIComponent(t[n]));return r.join("&")}function x(e,t){for(var r=t.length-1;0<=r;r--)if(t[r].p===e)return t[r]}"complete"===document.readyState?v():document.onreadystatechange=function(){"complete"===document.readyState&&v()},u.getLocationHref=function(){return r.location.href},u.processRules=function(e){var t,r,n=h,a=[];if(!e||!e.rules||"[object Array]"!==Object.prototype.toString.call(e.rules))return!1;var o=e.rules;o.length<=2&&function(e){for(var t=e.length-1;0<=t;t--)if("frequency"!==e[t].type)return!1;return!0}(o)&&(n=g);for(var s=o.length-1;0<=s;s--)if(t=o[s].values,r=o[s].type,-1!==c.indexOf(r))switch(o[s].type){case"url_contains":a.push(u.urlContains(t));break;case"url_match":a.push(u.urlMatch(t));break;case"url_does_not_contain":a.push(!u.urlContains(t));break;case"url_does_not_match":a.push(!u.urlMatch(t));break;case"frequency":a.push(u.frequency(t,n));break;case"anniversary":a.push(u.anniversary(t));break;case"custom_data":a.push(u.customDataRule(t));break;case"time_spent":a.push(u.timeSpent(t,e))}return a.every(function(e){return e})},u.urlContains=function(e){if(!e||"[object Array]"!==Object.prototype.toString.call(e))return!1;for(var t=u.getLocationHref(),r=e.length-1;0<=r;r--)if(-1<t.search(new RegExp(e[r].replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"),"i")))return!0;return!1},u.urlMatch=function(e){if(!e||"[object Array]"!==Object.prototype.toString.call(e))return!1;for(var t=u.getLocationHref(),r=e.length-1;0<=r;r--)if(new RegExp("^"+e[r].replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")+"$","i").test(t))return!0;return!1},u.frequency=function(e,t){if(!e||!e.hasOwnProperty("operator"))return!1;var r=e.operator,n=e.value;return!!i[r](n,t)},u.anniversary=function(e){var t=(new Date).getMonth();return parseInt(e)===t},u.customDataRule=function(e){if(e&&e.hasOwnProperty("operator")&&u.customData&&u.customData.length){var t=e.operator,r=e.key,n=e.value,a=u.customData[0][r];if(!isNaN(n)&&!isNaN(a)&&i[t](+n,+a)||isNaN(n)&&n===a||"[object Array]"===Object.prototype.toString.call(a)&&-1!==a.indexOf(n))return!0}return!1},u.timeSpent=function(e,t){if(!e||isNaN(e.time_spent))return!1;var r=e.time_spent;"minutes"===e.timeUnit&&(r*=60),r*=1e3;var n=[];return t.custom_data&&t.customData&&t.customData.length&&u.customData&&u.customData.length&&(n=D(t,u.customData[0])),setTimeout(function(){_(t.id,n)},r),!1},u.track=function(e){var t;if(u.customData=r.admCustomData,e===a.id)return _([e]);u.customData&&u.customData[0]&&(t=D(function(e){var t;if(e===a.id)return a;for(var r=0;r<a.pixels.length;r++)if(a.pixels[r].id===e){t=a.pixels[r];break}return t}(e),u.customData[0]));_([e],t)},u.__pt__=y,f.lv=p.lv=[s],e.setItem("adm.usrmeta",JSON.stringify(n))}(window);